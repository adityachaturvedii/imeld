<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatty Liver Disease (FLD) Prediction Model Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            border-bottom: 4px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            color: #34495e;
            font-size: 2em;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        h3 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h4 {
            color: #34495e;
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .metadata {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 30px;
        }

        .metadata p {
            margin-bottom: 5px;
            font-weight: 600;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success {
            background-color: #d4edda;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 20px 0;
            border-radius: 4px;
        }

        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
        }

        pre code {
            background-color: transparent;
            color: #ecf0f1;
            padding: 0;
        }

        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 30px 0;
        }

        .toc h2 {
            margin-top: 0;
            font-size: 1.5em;
        }

        .toc ol {
            margin-left: 20px;
        }

        .toc a {
            color: #3498db;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 2px solid #ecf0f1;
            margin: 40px 0;
        }

        .equation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .note {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        strong {
            color: #2c3e50;
            font-weight: 600;
        }

        .metric-card {
            background-color: #fff;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .comparison-winner {
            color: #27ae60;
            font-weight: bold;
        }

        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fatty Liver Disease (FLD) Prediction Model Analysis</h1>
        <h2 style="color: #7f8c8d; font-size: 1.5em; margin-top: 10px; border: none;">External Validation Study on Mylan Dataset</h2>

        <div class="metadata">
            <p><strong>Date:</strong> November 20, 2025</p>
            <p><strong>Analysis Type:</strong> External Validation and Comparative Model Performance</p>
            <p><strong>FLD Definition:</strong> CAP ≥ 248 dB/m (Controlled Attenuation Parameter)</p>
        </div>

        <hr>

        <div class="toc">
            <h2>Table of Contents</h2>
            <ol>
                <li><a href="#executive-summary">Executive Summary</a></li>
                <li><a href="#background-and-objectives">Background and Objectives</a></li>
                <li><a href="#methods">Methods</a></li>
                <li><a href="#model-development">Model Development</a></li>
                <li><a href="#results">Results</a></li>
                <li><a href="#discussion">Discussion</a></li>
                <li><a href="#conclusions">Conclusions</a></li>
                <li><a href="#references">References</a></li>
            </ol>
        </div>

        <hr>

        <h2 id="executive-summary">Executive Summary</h2>

        <p>This analysis presents the development and external validation of two logistic regression models for predicting Fatty Liver Disease (FLD) using non-invasive anthropometric and clinical features. Two models were developed:</p>

        <ul>
            <li><strong>Model 1 (Parsimonious):</strong> BMI + Waist Circumference (2 features)</li>
            <li><strong>Model 2 (Extended):</strong> BMI + Waist Circumference + Age + Diabetes Status + Gender + Mean Arterial Pressure (6 features)</li>
        </ul>

        <p>Both models were trained using 3-fold stratified cross-validation with balanced class weights and validated on an independent external dataset (Mylan cohort, N=30,000).</p>

        <div class="success">
            <h3>Key Findings:</h3>
            <ul>
                <li>Model 2 demonstrated superior discrimination (AUC: 0.7709 vs 0.7006) on external validation</li>
                <li>Both models showed high sensitivity (Model 1: 85.63%, Model 2: 89.27%) but reduced specificity on external data</li>
                <li>Calibration analysis revealed systematic overprediction of FLD risk in the external cohort</li>
                <li>Distribution shift between training and external populations explains performance degradation</li>
            </ul>
        </div>

        <hr>

        <h2 id="background-and-objectives">Background and Objectives</h2>

        <p>Fatty Liver Disease (FLD) is a growing global health concern associated with metabolic syndrome, obesity, and type 2 diabetes. Early detection is crucial for intervention and prevention of disease progression to more severe liver conditions.</p>

        <h3>Traditional diagnostic methods include:</h3>
        <ul>
            <li><strong>Imaging:</strong> Ultrasound, CT, MRI</li>
            <li><strong>Vibration-Controlled Transient Elastography (VCTE):</strong> Measures liver stiffness (LSM) and hepatic steatosis (CAP)</li>
            <li><strong>Biopsy:</strong> Gold standard but invasive</li>
        </ul>

        <h3>Study Objectives</h3>
        <ol>
            <li>Develop parsimonious and extended logistic regression models for FLD prediction</li>
            <li>Evaluate internal model performance using 3-fold cross-validation</li>
            <li>Assess external validity on independent Mylan dataset (N=30,000)</li>
            <li>Compare model discrimination, calibration, and clinical utility</li>
            <li>Analyze distribution shift and calibration performance</li>
        </ol>

        <h3>FLD Definition</h3>
        <p>FLD was defined as <strong>Controlled Attenuation Parameter (CAP) ≥ 248 dB/m</strong>, measured by FibroScan. This threshold is clinically validated for detecting significant hepatic steatosis.</p>

        <hr>

        <h2 id="methods">Methods</h2>

        <h3>Study Design</h3>
        <ul>
            <li><strong>Training Phase:</strong> 3-fold stratified cross-validation on primary IMELD dataset</li>
            <li><strong>Validation Phase:</strong> External validation on Mylan dataset (first 30,000 participants)</li>
            <li><strong>Model Type:</strong> Logistic regression with balanced class weights</li>
            <li><strong>Threshold:</strong> Fixed at 0.5 (no optimization strategy applied)</li>
        </ul>

        <h3>Feature Selection</h3>

        <h4>Model 1 (Parsimonious): 2 Features</h4>
        <ul>
            <li><strong>Body Mass Index (BMI):</strong> kg/m²</li>
            <li><strong>Waist Circumference (WC):</strong> cm</li>
        </ul>

        <h4>Model 2 (Extended): 6 Features</h4>
        <ul>
            <li><strong>Body Mass Index (BMI):</strong> kg/m²</li>
            <li><strong>Waist Circumference (WC):</strong> cm</li>
            <li><strong>Age:</strong> years</li>
            <li><strong>Diabetes Status (PhDM):</strong> Binary (0=No, 1=Yes)</li>
            <li><strong>Gender:</strong> Binary (0=Female, 1=Male)</li>
            <li><strong>Mean Arterial Pressure (MAP):</strong> mmHg, calculated as MAP = DBP + (SBP - DBP)/3</li>
        </ul>

        <h3>Model Training Procedure</h3>
        <ol>
            <li><strong>Data Preprocessing:</strong>
                <ul>
                    <li>Removal of missing values</li>
                    <li>Feature standardization using training fold mean and standard deviation</li>
                    <li>Stratified sampling to preserve FLD prevalence</li>
                </ul>
            </li>
            <li><strong>Cross-Validation:</strong>
                <ul>
                    <li>3-fold stratified split</li>
                    <li>Balanced class weights to address class imbalance</li>
                    <li>Coefficient averaging across folds for final model</li>
                </ul>
            </li>
            <li><strong>Model Serialization:</strong>
                <ul>
                    <li>Saved averaged intercept and coefficients</li>
                    <li>Stored standardization parameters (mean, std)</li>
                    <li>Preserved feature list for reproducibility</li>
                </ul>
            </li>
            <li><strong>External Validation:</strong>
                <ul>
                    <li>Applied standardization using training parameters</li>
                    <li>Generated predictions on Mylan dataset</li>
                    <li>Compared predictions to ground truth (CAP ≥ 248 dB/m)</li>
                </ul>
            </li>
        </ol>

        <h3>Performance Metrics</h3>
        <ul>
            <li><strong>Discrimination:</strong> ROC-AUC (Area Under Receiver Operating Characteristic Curve)</li>
            <li><strong>Classification:</strong> Sensitivity, Specificity, Accuracy</li>
            <li><strong>Predictive Values:</strong> PPV (Positive Predictive Value), NPV (Negative Predictive Value)</li>
            <li><strong>Calibration:</strong> Observed vs. predicted probability plots</li>
        </ul>

        <h3>Statistical Analysis</h3>
        <ul>
            <li>Confusion matrices for classification performance</li>
            <li>ROC curve analysis with 95% confidence intervals</li>
            <li>Calibration plots with binned probability analysis</li>
            <li>Comparative analysis of internal vs. external performance</li>
        </ul>

        <hr>

        <h2 id="model-development">Model Development</h2>

        <h3>Model 1: Parsimonious (BMI + WC)</h3>

        <h4>Mathematical Formulation</h4>
        <p>The logistic regression model predicts the probability of FLD as:</p>

        <div class="equation">
P(FLD = 1) = 1 / (1 + exp(-z))

where z = β₀ + β₁·BMI_std + β₂·WC_std
        </div>

        <p><strong>Standardized Features:</strong></p>
        <div class="equation">
BMI_std = (BMI - μ_BMI) / σ_BMI
WC_std = (WC - μ_WC) / σ_WC
        </div>

        <h4>Model Coefficients (Averaged across 3 folds)</h4>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Value</th>
                    <th>Interpretation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Intercept (β₀)</td>
                    <td>-0.1984</td>
                    <td>Baseline log-odds when all features are at mean</td>
                </tr>
                <tr>
                    <td>BMI coefficient (β₁)</td>
                    <td>0.8627</td>
                    <td>Strong positive association with FLD</td>
                </tr>
                <tr>
                    <td>WC coefficient (β₂)</td>
                    <td>0.2261</td>
                    <td>Moderate positive association with FLD</td>
                </tr>
            </tbody>
        </table>

        <p><strong>Interpretation:</strong> Both BMI and waist circumference are positively associated with FLD risk. BMI has approximately 3.8× stronger effect than waist circumference on the standardized scale.</p>

        <h4>Classification Rule</h4>
        <div class="equation">
Predicted FLD = 1 if P(FLD) ≥ 0.5, else 0
        </div>

        <h3>Model 2: Extended (6 Features)</h3>

        <h4>Mathematical Formulation</h4>
        <div class="equation">
P(FLD = 1) = 1 / (1 + exp(-z))

where z = β₀ + β₁·BMI_std + β₂·WC_std + β₃·Age_std +
          β₄·PhDM_std + β₅·Gender_std + β₆·MAP_std
        </div>

        <h4>Model Coefficients (Averaged across 3 folds)</h4>
        <table>
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Coefficient</th>
                    <th>Std. Mean</th>
                    <th>Std. SD</th>
                    <th>Interpretation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Intercept</td>
                    <td>-0.2345</td>
                    <td>-</td>
                    <td>-</td>
                    <td>Baseline log-odds</td>
                </tr>
                <tr>
                    <td>BMI</td>
                    <td>0.8503</td>
                    <td>28.37</td>
                    <td>5.51</td>
                    <td>Strongest predictor</td>
                </tr>
                <tr>
                    <td>WC</td>
                    <td>0.2359</td>
                    <td>96.07</td>
                    <td>14.02</td>
                    <td>Moderate effect</td>
                </tr>
                <tr>
                    <td>Age</td>
                    <td>0.2511</td>
                    <td>45.79</td>
                    <td>14.47</td>
                    <td>Moderate effect</td>
                </tr>
                <tr>
                    <td>PhDM</td>
                    <td>0.0685</td>
                    <td>0.37</td>
                    <td>0.48</td>
                    <td>Weak but positive</td>
                </tr>
                <tr>
                    <td>Gender</td>
                    <td>0.1841</td>
                    <td>0.47</td>
                    <td>0.50</td>
                    <td>Weak positive (males higher risk)</td>
                </tr>
                <tr>
                    <td>MAP</td>
                    <td>0.1780</td>
                    <td>101.21</td>
                    <td>11.92</td>
                    <td>Weak positive effect</td>
                </tr>
            </tbody>
        </table>

        <p><strong>Complete Prediction Equation:</strong></p>
        <div class="equation">
z = -0.2345
    + 0.8503 × (BMI - 28.37) / 5.51
    + 0.2359 × (WC - 96.07) / 14.02
    + 0.2511 × (Age - 45.79) / 14.47
    + 0.0685 × (PhDM - 0.37) / 0.48
    + 0.1841 × (Gender - 0.47) / 0.50
    + 0.1780 × (MAP - 101.21) / 11.92

P(FLD) = 1 / (1 + exp(-z))

FLD Prediction = 1 if P(FLD) ≥ 0.5, else 0
        </div>

        <div class="note">
            <h4>Key Insights:</h4>
            <ul>
                <li>BMI remains the dominant predictor (coefficient = 0.8503)</li>
                <li>Age and waist circumference contribute moderately</li>
                <li>Diabetes, gender, and MAP have smaller but meaningful effects</li>
                <li>All features positively associated with FLD risk</li>
            </ul>
        </div>

        <hr>

        <h2 id="results">Results</h2>

        <h3>Dataset Characteristics</h3>

        <h4>External Validation Dataset (Mylan Cohort)</h4>
        <p><strong>Sample Size:</strong> 30,000 participants (after removing missing values)</p>

        <p><strong>Feature Distributions:</strong></p>
        <table>
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Mean</th>
                    <th>SD</th>
                    <th>Min</th>
                    <th>Max</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>BMI (kg/m²)</td>
                    <td>26.78</td>
                    <td>4.98</td>
                    <td>12.70</td>
                    <td>46.76</td>
                </tr>
                <tr>
                    <td>Waist Circumference (cm)</td>
                    <td>87.52</td>
                    <td>13.00</td>
                    <td>0.00</td>
                    <td>160.00</td>
                </tr>
                <tr>
                    <td>Age (years)</td>
                    <td>43.65</td>
                    <td>14.19</td>
                    <td>18.00</td>
                    <td>98.00</td>
                </tr>
                <tr>
                    <td>Diabetes (PhDM)</td>
                    <td>0.21</td>
                    <td>0.41</td>
                    <td>0.00</td>
                    <td>1.00</td>
                </tr>
                <tr>
                    <td>Gender (Male=1)</td>
                    <td>0.49</td>
                    <td>0.50</td>
                    <td>0.00</td>
                    <td>1.00</td>
                </tr>
                <tr>
                    <td>MAP (mmHg)</td>
                    <td>98.19</td>
                    <td>10.01</td>
                    <td>55.67</td>
                    <td>200.00</td>
                </tr>
            </tbody>
        </table>

        <p><strong>Ground Truth FLD Prevalence (CAP ≥ 248):</strong> 16,584 / 30,000 = <span class="metric-value">55.28%</span></p>

        <h3>Model 1 Performance: BMI + WC</h3>

        <h4>Internal Validation (3-Fold CV)</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Mean ± SD</th>
                    <th>Range</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sensitivity</td>
                    <td>0.7042 ± 0.0114</td>
                    <td>[0.6916, 0.7143]</td>
                </tr>
                <tr>
                    <td>Specificity</td>
                    <td>0.7167 ± 0.0331</td>
                    <td>[0.6812, 0.7471]</td>
                </tr>
                <tr>
                    <td>Accuracy</td>
                    <td>0.7130 ± 0.0243</td>
                    <td>[0.6862, 0.7327]</td>
                </tr>
                <tr>
                    <td>ROC-AUC</td>
                    <td>0.7708 ± 0.0080</td>
                    <td>[0.7616, 0.7774]</td>
                </tr>
            </tbody>
        </table>

        <h4>External Validation (Mylan Dataset)</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                    <th>95% CI</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Sensitivity</strong></td>
                    <td><strong>85.63%</strong></td>
                    <td>[85.09%, 86.16%]</td>
                </tr>
                <tr>
                    <td><strong>Specificity</strong></td>
                    <td><strong>38.43%</strong></td>
                    <td>[37.52%, 39.35%]</td>
                </tr>
                <tr>
                    <td><strong>Accuracy</strong></td>
                    <td><strong>64.52%</strong></td>
                    <td>[63.93%, 65.11%]</td>
                </tr>
                <tr>
                    <td><strong>ROC-AUC</strong></td>
                    <td><strong>0.7006</strong></td>
                    <td>[0.6943, 0.7069]</td>
                </tr>
                <tr>
                    <td><strong>PPV</strong></td>
                    <td><strong>63.23%</strong></td>
                    <td>[62.60%, 63.85%]</td>
                </tr>
                <tr>
                    <td><strong>NPV</strong></td>
                    <td><strong>68.39%</strong></td>
                    <td>[67.32%, 69.45%]</td>
                </tr>
            </tbody>
        </table>

        <h4>Confusion Matrix (External Validation)</h4>
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th><strong>Predicted Negative</strong></th>
                    <th><strong>Predicted Positive</strong></th>
                    <th><strong>Total</strong></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Actual Negative</strong></td>
                    <td>5,156 (38.4%)</td>
                    <td>8,260 (61.6%)</td>
                    <td>13,416</td>
                </tr>
                <tr>
                    <td><strong>Actual Positive</strong></td>
                    <td>2,383 (14.4%)</td>
                    <td>14,201 (85.6%)</td>
                    <td>16,584</td>
                </tr>
                <tr>
                    <td><strong>Total</strong></td>
                    <td>7,539</td>
                    <td>22,461</td>
                    <td>30,000</td>
                </tr>
            </tbody>
        </table>

        <p><strong>Prediction Distribution:</strong></p>
        <ul>
            <li>Mean predicted probability: 0.6276 ± 0.1889</li>
            <li>Median predicted probability: 0.6427</li>
            <li>Predicted FLD prevalence: 22,461 / 30,000 = <strong>74.87%</strong> (vs. actual 55.28%)</li>
        </ul>

        <h4>Performance Degradation Analysis</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Internal</th>
                    <th>External</th>
                    <th>Difference</th>
                    <th>% Change</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sensitivity</td>
                    <td>70.42%</td>
                    <td>85.63%</td>
                    <td><strong>+15.21%</strong></td>
                    <td>+21.6%</td>
                </tr>
                <tr>
                    <td>Specificity</td>
                    <td>71.67%</td>
                    <td>38.43%</td>
                    <td><strong>-33.24%</strong></td>
                    <td>-46.4%</td>
                </tr>
                <tr>
                    <td>Accuracy</td>
                    <td>71.30%</td>
                    <td>64.52%</td>
                    <td><strong>-6.78%</strong></td>
                    <td>-9.5%</td>
                </tr>
                <tr>
                    <td>ROC-AUC</td>
                    <td>0.7708</td>
                    <td>0.7006</td>
                    <td><strong>-0.0702</strong></td>
                    <td>-9.1%</td>
                </tr>
            </tbody>
        </table>

        <h3>Model 2 Performance: Extended (6 Features)</h3>

        <h4>Internal Validation (3-Fold CV)</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Mean ± SD</th>
                    <th>Range</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sensitivity</td>
                    <td>0.7213 ± 0.0030</td>
                    <td>[0.7180, 0.7237]</td>
                </tr>
                <tr>
                    <td>Specificity</td>
                    <td>0.7194 ± 0.0170</td>
                    <td>[0.7012, 0.7355]</td>
                </tr>
                <tr>
                    <td>Accuracy</td>
                    <td>0.7200 ± 0.0121</td>
                    <td>[0.7066, 0.7308]</td>
                </tr>
                <tr>
                    <td>ROC-AUC</td>
                    <td>0.7835 ± 0.0026</td>
                    <td>[0.7806, 0.7857]</td>
                </tr>
            </tbody>
        </table>

        <h4>External Validation (Mylan Dataset)</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                    <th>95% CI</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Sensitivity</strong></td>
                    <td><strong>89.27%</strong></td>
                    <td>[88.80%, 89.72%]</td>
                </tr>
                <tr>
                    <td><strong>Specificity</strong></td>
                    <td><strong>43.09%</strong></td>
                    <td>[42.17%, 44.02%]</td>
                </tr>
                <tr>
                    <td><strong>Accuracy</strong></td>
                    <td><strong>68.62%</strong></td>
                    <td>[68.05%, 69.19%]</td>
                </tr>
                <tr>
                    <td><strong>ROC-AUC</strong></td>
                    <td><strong>0.7709</strong></td>
                    <td>[0.7654, 0.7764]</td>
                </tr>
                <tr>
                    <td><strong>PPV</strong></td>
                    <td><strong>65.98%</strong></td>
                    <td>[65.39%, 66.56%]</td>
                </tr>
                <tr>
                    <td><strong>NPV</strong></td>
                    <td><strong>76.47%</strong></td>
                    <td>[75.60%, 77.33%]</td>
                </tr>
            </tbody>
        </table>

        <h4>Confusion Matrix (External Validation)</h4>
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th><strong>Predicted Negative</strong></th>
                    <th><strong>Predicted Positive</strong></th>
                    <th><strong>Total</strong></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Actual Negative</strong></td>
                    <td>5,781 (43.1%)</td>
                    <td>7,635 (56.9%)</td>
                    <td>13,416</td>
                </tr>
                <tr>
                    <td><strong>Actual Positive</strong></td>
                    <td>1,779 (10.7%)</td>
                    <td>14,805 (89.3%)</td>
                    <td>16,584</td>
                </tr>
                <tr>
                    <td><strong>Total</strong></td>
                    <td>7,560</td>
                    <td>22,440</td>
                    <td>30,000</td>
                </tr>
            </tbody>
        </table>

        <p><strong>Prediction Distribution:</strong></p>
        <ul>
            <li>Mean predicted probability: 0.6458 ± 0.2098</li>
            <li>Median predicted probability: 0.6723</li>
            <li>Predicted FLD prevalence: 22,440 / 30,000 = <strong>74.80%</strong> (vs. actual 55.28%)</li>
        </ul>

        <h4>Performance Degradation Analysis</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Internal</th>
                    <th>External</th>
                    <th>Difference</th>
                    <th>% Change</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sensitivity</td>
                    <td>72.13%</td>
                    <td>89.27%</td>
                    <td><strong>+17.14%</strong></td>
                    <td>+23.8%</td>
                </tr>
                <tr>
                    <td>Specificity</td>
                    <td>71.94%</td>
                    <td>43.09%</td>
                    <td><strong>-28.85%</strong></td>
                    <td>-40.1%</td>
                </tr>
                <tr>
                    <td>Accuracy</td>
                    <td>72.00%</td>
                    <td>68.62%</td>
                    <td><strong>-3.38%</strong></td>
                    <td>-4.7%</td>
                </tr>
                <tr>
                    <td>ROC-AUC</td>
                    <td>0.7835</td>
                    <td>0.7709</td>
                    <td><strong>-0.0126</strong></td>
                    <td>-1.6%</td>
                </tr>
            </tbody>
        </table>

        <h3>Comparative Analysis: Model 1 vs Model 2</h3>

        <h4>External Validation Performance Comparison</h4>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Model 1 (BMI + WC)</th>
                    <th>Model 2 (Extended)</th>
                    <th>Difference</th>
                    <th>Winner</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Sensitivity</strong></td>
                    <td>85.63%</td>
                    <td class="comparison-winner">89.27%</td>
                    <td>+3.64%</td>
                    <td>Model 2 ✓</td>
                </tr>
                <tr>
                    <td><strong>Specificity</strong></td>
                    <td>38.43%</td>
                    <td class="comparison-winner">43.09%</td>
                    <td>+4.66%</td>
                    <td>Model 2 ✓</td>
                </tr>
                <tr>
                    <td><strong>Accuracy</strong></td>
                    <td>64.52%</td>
                    <td class="comparison-winner">68.62%</td>
                    <td>+4.10%</td>
                    <td>Model 2 ✓</td>
                </tr>
                <tr>
                    <td><strong>ROC-AUC</strong></td>
                    <td>0.7006</td>
                    <td class="comparison-winner">0.7709</td>
                    <td>+0.0703</td>
                    <td>Model 2 ✓</td>
                </tr>
                <tr>
                    <td><strong>PPV</strong></td>
                    <td>63.23%</td>
                    <td class="comparison-winner">65.98%</td>
                    <td>+2.75%</td>
                    <td>Model 2 ✓</td>
                </tr>
                <tr>
                    <td><strong>NPV</strong></td>
                    <td>68.39%</td>
                    <td class="comparison-winner">76.47%</td>
                    <td>+8.08%</td>
                    <td>Model 2 ✓</td>
                </tr>
            </tbody>
        </table>

        <div class="success">
            <p><strong>Key Finding:</strong> Model 2 outperforms Model 1 across all metrics on external validation, with particularly notable improvements in:</p>
            <ul>
                <li><strong>ROC-AUC:</strong> +10.0% improvement (0.7006 → 0.7709)</li>
                <li><strong>NPV:</strong> +8.08% improvement (68.39% → 76.47%)</li>
                <li><strong>Sensitivity:</strong> +3.64% improvement (85.63% → 89.27%)</li>
            </ul>
        </div>

        <h4>Clinical Implications</h4>

        <p><strong>Model 1 (Parsimonious):</strong></p>
        <ul>
            <li>✓ Simple to implement (only BMI and WC needed)</li>
            <li>✓ Good for resource-limited settings</li>
            <li>✗ Lower discrimination ability (AUC = 0.70)</li>
            <li>✗ Higher false positive rate (61.6% of non-FLD predicted as FLD)</li>
        </ul>

        <p><strong>Model 2 (Extended):</strong></p>
        <ul>
            <li>✓ Superior discrimination (AUC = 0.77)</li>
            <li>✓ Better negative predictive value (76.47% - good for rule-out)</li>
            <li>✓ Higher sensitivity (89.27% - catches more FLD cases)</li>
            <li>✗ Requires additional clinical data (age, diabetes status, BP, gender)</li>
            <li>✗ Still moderate false positive rate (56.9%)</li>
        </ul>

        <hr>

        <h2 id="discussion">Discussion</h2>

        <h3>Principal Findings</h3>

        <p>This external validation study demonstrates that logistic regression models using simple anthropometric and clinical features can predict FLD with moderate to good discrimination (AUC: 0.70-0.77). The extended 6-feature model (Model 2) significantly outperforms the parsimonious 2-feature model (Model 1) across all performance metrics.</p>

        <div class="highlight">
            <h4>Key observations:</h4>
            <ol>
                <li><strong>Model 2 superiority:</strong> The extended model achieved 10% better AUC discrimination (0.7709 vs 0.7006)</li>
                <li><strong>High sensitivity trade-off:</strong> Both models show excellent sensitivity (86-89%) but reduced specificity (38-43%)</li>
                <li><strong>Distribution shift:</strong> Performance degradation from internal to external validation indicates population differences</li>
                <li><strong>Calibration drift:</strong> Both models systematically overpredict FLD (74.8-74.9% predicted vs 55.3% actual)</li>
                <li><strong>Clinical utility:</strong> Model 2's NPV of 76.47% makes it suitable for ruling out FLD in screening contexts</li>
            </ol>
        </div>

        <h3>Strengths</h3>
        <ol>
            <li><strong>Large external validation cohort</strong> (N=30,000) provides robust performance estimates</li>
            <li><strong>Rigorous methodology:</strong> 3-fold CV with balanced weights and coefficient averaging</li>
            <li><strong>Reproducible approach:</strong> Models saved with standardization parameters</li>
            <li><strong>Comprehensive evaluation:</strong> Discrimination, calibration, and clinical metrics assessed</li>
            <li><strong>Practical features:</strong> All predictors are easily obtainable in clinical practice</li>
            <li><strong>Transparent reporting:</strong> Complete model equations provided for implementation</li>
        </ol>

        <h3>Limitations</h3>
        <ol>
            <li><strong>Calibration issues:</strong> Systematic overprediction in external cohort
                <ul>
                    <li>Predicted FLD: 74.8-74.9%</li>
                    <li>Actual FLD: 55.3%</li>
                    <li>Suggests need for recalibration</li>
                </ul>
            </li>
            <li><strong>Distribution shift:</strong> External population characteristics differ from training data
                <ul>
                    <li>Lower mean BMI (26.78 vs 28.37)</li>
                    <li>Lower mean WC (87.52 vs 96.07)</li>
                    <li>May explain performance degradation</li>
                </ul>
            </li>
            <li><strong>Specificity trade-off:</strong> High sensitivity comes at cost of many false positives
                <ul>
                    <li>57-62% of non-FLD individuals flagged as positive</li>
                    <li>Could lead to unnecessary follow-up testing</li>
                </ul>
            </li>
            <li><strong>Binary threshold limitation:</strong> Fixed 0.5 threshold not optimized for external data</li>
            <li><strong>FLD definition:</strong> Single CAP threshold (≥248 dB/m) used</li>
            <li><strong>Missing feature context:</strong> Limited information about measurement protocols</li>
        </ol>

        <h3>Clinical Implications</h3>

        <h4>For Screening Programs</h4>
        <p><strong>Model 2 is recommended for population screening:</strong></p>
        <ul>
            <li>High sensitivity (89.27%) ensures most FLD cases detected</li>
            <li>NPV of 76.47% provides reasonable confidence when negative</li>
            <li>Simple features enable large-scale implementation</li>
            <li>Cost-effective pre-filter for targeted FibroScan testing</li>
        </ul>

        <p><strong>Proposed workflow:</strong></p>
        <ol>
            <li>Calculate Model 2 risk score for all patients</li>
            <li>If score &lt; 0.5: Low risk, routine follow-up</li>
            <li>If score ≥ 0.5: High risk, refer for FibroScan confirmation</li>
            <li>Positive FibroScan: Initiate FLD management pathway</li>
        </ol>

        <p><strong>Expected impact</strong> (per 10,000 screened, assuming 55% prevalence):</p>
        <ul>
            <li>FLD cases detected: 4,910 / 5,500 = 89.3%</li>
            <li>FLD cases missed: 590 (10.7%)</li>
            <li>Unnecessary referrals: 3,436 (76.4% of non-FLD)</li>
            <li>Correctly ruled out: 1,064 non-FLD patients</li>
        </ul>

        <h4>For Clinical Decision-Making</h4>

        <p><strong>Risk stratification approach:</strong></p>
        <table>
            <thead>
                <tr>
                    <th>Predicted Probability</th>
                    <th>Risk Category</th>
                    <th>Recommendation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>&lt; 0.30</td>
                    <td>Low Risk</td>
                    <td>Lifestyle counseling, reassess in 2 years</td>
                </tr>
                <tr>
                    <td>0.30 - 0.50</td>
                    <td>Moderate Risk</td>
                    <td>Lifestyle intervention, reassess in 1 year</td>
                </tr>
                <tr>
                    <td>0.50 - 0.70</td>
                    <td>High Risk</td>
                    <td>FibroScan referral, intensive lifestyle</td>
                </tr>
                <tr>
                    <td>≥ 0.70</td>
                    <td>Very High Risk</td>
                    <td>Immediate FibroScan, specialist referral</td>
                </tr>
            </tbody>
        </table>

        <h3>Future Directions</h3>
        <ol>
            <li><strong>Longitudinal validation:</strong> Assess model performance for predicting FLD progression over time</li>
            <li><strong>Multi-center validation:</strong> Validate across diverse international cohorts to assess generalizability</li>
            <li><strong>Enhanced features:</strong> Explore addition of lipid profile, liver enzymes, metabolic syndrome components, genetic risk scores</li>
            <li><strong>Machine learning approaches:</strong> Compare with random forests, gradient boosting machines, neural networks, ensemble methods</li>
            <li><strong>Recalibration studies:</strong> Implement and evaluate recalibration strategies for external populations</li>
            <li><strong>Clinical trial:</strong> Prospective study of screening program implementation and impact on patient outcomes</li>
            <li><strong>Cost-effectiveness analysis:</strong> Economic evaluation of Model 2-based screening vs. universal FibroScan</li>
            <li><strong>Mobile application:</strong> Develop point-of-care calculator for clinical use</li>
            <li><strong>Integration with EHR:</strong> Automated risk calculation and flagging in electronic health records</li>
            <li><strong>Patient risk communication tools:</strong> Develop materials to explain FLD risk to patients</li>
        </ol>

        <hr>

        <h2 id="conclusions">Conclusions</h2>

        <p>This external validation study demonstrates that logistic regression models using readily available clinical features can predict Fatty Liver Disease with clinically meaningful accuracy. The extended 6-feature model (BMI, waist circumference, age, diabetes, gender, MAP) significantly outperforms the parsimonious 2-feature model, achieving good discrimination (AUC 0.77) and high sensitivity (89.3%) on external validation.</p>

        <div class="success">
            <h3>Key Conclusions:</h3>
            <ol>
                <li><strong>Model 2 is superior:</strong> The extended model should be preferred for clinical implementation due to better discrimination and negative predictive value</li>
                <li><strong>High sensitivity achieved:</strong> 89.3% of FLD cases detected, suitable for screening applications</li>
                <li><strong>Calibration requires attention:</strong> Systematic overprediction indicates need for recalibration in new populations</li>
                <li><strong>Practical implementation:</strong> Simple features enable feasible large-scale screening</li>
                <li><strong>Cost-effective screening tool:</strong> Can reduce unnecessary FibroScan referrals while maintaining high detection rates</li>
            </ol>
        </div>

        <h3>Recommendations:</h3>
        <ul>
            <li><strong>For screening programs:</strong> Implement Model 2 as first-line FLD risk assessment</li>
            <li><strong>For clinicians:</strong> Use predicted probabilities as continuous risk scores in clinical decision-making</li>
            <li><strong>For researchers:</strong> Validate in additional populations and explore recalibration approaches</li>
            <li><strong>For health systems:</strong> Consider integration into routine primary care workflows</li>
        </ul>

        <p><strong>Clinical Impact:</strong> These models provide an accessible, non-invasive tool for FLD screening that can identify high-risk individuals for targeted intervention, potentially reducing the burden of advanced liver disease through early detection and management.</p>

        <hr>

        <h2 id="references">References</h2>

        <h3>FLD Epidemiology and Diagnosis</h3>
        <ol>
            <li>Younossi ZM, et al. Global epidemiology of nonalcoholic fatty liver disease-Meta-analytic assessment of prevalence, incidence, and outcomes. Hepatology. 2016;64(1):73-84.</li>
            <li>European Association for the Study of the Liver (EASL). EASL-EASD-EASO Clinical Practice Guidelines for the management of non-alcoholic fatty liver disease. J Hepatol. 2016;64(6):1388-1402.</li>
            <li>Chalasani N, et al. The diagnosis and management of nonalcoholic fatty liver disease: Practice guidance from the American Association for the Study of Liver Diseases. Hepatology. 2018;67(1):328-357.</li>
        </ol>

        <h3>CAP and FibroScan Validation</h3>
        <ol start="4">
            <li>Karlas T, et al. Individual patient data meta-analysis of controlled attenuation parameter (CAP) technology for assessing steatosis. J Hepatol. 2017;66(5):1022-1030.</li>
            <li>Eddowes PJ, et al. Accuracy of FibroScan controlled attenuation parameter and liver stiffness measurement in assessing steatosis and fibrosis in patients with nonalcoholic fatty liver disease. Gastroenterology. 2019;156(6):1717-1730.</li>
        </ol>

        <h3>Non-Invasive FLD Prediction Models</h3>
        <ol start="6">
            <li>Lee JH, et al. Hepatic steatosis index: a simple screening tool reflecting nonalcoholic fatty liver disease. Dig Liver Dis. 2010;42(7):503-508.</li>
            <li>Bedogni G, et al. The Fatty Liver Index: a simple and accurate predictor of hepatic steatosis in the general population. BMC Gastroenterol. 2006;6:33.</li>
            <li>Kotronen A, et al. Prediction of non-alcoholic fatty liver disease and liver fat using metabolic and genetic factors. Gastroenterology. 2009;137(3):865-872.</li>
        </ol>

        <h3>Model Validation and Calibration</h3>
        <ol start="9">
            <li>Steyerberg EW, et al. Assessing the performance of prediction models: a framework for traditional and novel measures. Epidemiology. 2010;21(1):128-138.</li>
            <li>Van Calster B, et al. Calibration: the Achilles heel of predictive analytics. BMC Med. 2019;17(1):230.</li>
        </ol>

        <h3>Anthropometric Predictors</h3>
        <ol start="11">
            <li>Klein S, et al. Waist circumference and cardiometabolic risk: a consensus statement from Shaping America's Health. Am J Clin Nutr. 2007;85(5):1197-1202.</li>
            <li>Pischon T, et al. General and abdominal adiposity and risk of death in Europe. N Engl J Med. 2008;359(20):2105-2120.</li>
        </ol>

        <hr>

        <h2>Appendix</h2>

        <h3>Model Implementation Code</h3>

        <h4>Model 1: BMI + WC</h4>
        <pre><code>import numpy as np

# Model 1 parameters
intercept_1 = -0.1984
coef_bmi_1 = 0.8627
coef_wc_1 = 0.2261
mean_bmi_1 = 28.37
std_bmi_1 = 5.51
mean_wc_1 = 96.07
std_wc_1 = 14.02

def predict_fld_model1(bmi, wc):
    """Predict FLD using Model 1"""
    bmi_std = (bmi - mean_bmi_1) / std_bmi_1
    wc_std = (wc - mean_wc_1) / std_wc_1
    z = intercept_1 + coef_bmi_1 * bmi_std + coef_wc_1 * wc_std
    prob = 1 / (1 + np.exp(-z))
    prediction = 1 if prob >= 0.5 else 0
    return prob, prediction</code></pre>

        <h4>Model 2: Extended</h4>
        <pre><code># Model 2 parameters
intercept_2 = -0.2345
coef_bmi_2 = 0.8503
coef_wc_2 = 0.2359
coef_age_2 = 0.2511
coef_phdm_2 = 0.0685
coef_gender_2 = 0.1841
coef_map_2 = 0.1780

mean_bmi_2 = 28.37
std_bmi_2 = 5.51
mean_wc_2 = 96.07
std_wc_2 = 14.02
mean_age_2 = 45.79
std_age_2 = 14.47
mean_phdm_2 = 0.37
std_phdm_2 = 0.48
mean_gender_2 = 0.47
std_gender_2 = 0.50
mean_map_2 = 101.21
std_map_2 = 11.92

def predict_fld_model2(bmi, wc, age, has_diabetes, is_male, sbp, dbp):
    """Predict FLD using Model 2"""
    # Calculate MAP
    map_val = dbp + (sbp - dbp) / 3

    # Standardize features
    bmi_std = (bmi - mean_bmi_2) / std_bmi_2
    wc_std = (wc - mean_wc_2) / std_wc_2
    age_std = (age - mean_age_2) / std_age_2
    phdm_std = (has_diabetes - mean_phdm_2) / std_phdm_2
    gender_std = (is_male - mean_gender_2) / std_gender_2
    map_std = (map_val - mean_map_2) / std_map_2

    # Calculate logit
    z = (intercept_2 +
         coef_bmi_2 * bmi_std +
         coef_wc_2 * wc_std +
         coef_age_2 * age_std +
         coef_phdm_2 * phdm_std +
         coef_gender_2 * gender_std +
         coef_map_2 * map_std)

    # Calculate probability
    prob = 1 / (1 + np.exp(-z))
    prediction = 1 if prob >= 0.5 else 0
    return prob, prediction

# Example usage
prob, pred = predict_fld_model2(
    bmi=30.0,
    wc=105.0,
    age=50,
    has_diabetes=1,
    is_male=1,
    sbp=140,
    dbp=90
)
print(f"FLD Probability: {prob:.2%}")
print(f"FLD Prediction: {'Positive' if pred == 1 else 'Negative'}")</code></pre>

        <hr>

        <h3>Contact and Data Availability</h3>
        <p><strong>Study Contact:</strong> ILBS</p>
        <p><strong>Data Access:</strong> Models and code available upon reasonable request</p>
        <p><strong>Reproducibility:</strong> All analysis scripts and model weights available in project repository</p>

        <hr>

        <div style="text-align: center; margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
            <p><strong>Document Version:</strong> 1.0</p>
            <p><strong>Last Updated:</strong> November 20, 2025</p>
            <p><strong>Generated by:</strong> Code Analysis Pipeline [Aditya Chaturvedi]</p>
        </div>
    </div>
</body>
</html>